<!DOCTYPE html>
<html>
<head>
<script src="//code.jquery.com/jquery-1.11.0.min.js"></script>
<script src="//code.jquery.com/jquery-migrate-1.2.1.min.js"></script>

<script>


var SynAPI = (function(){
	var baseApiUrl = 'api.php';
	var lon;
	var lat;

	function init(){
		getLocation();
	}

	function getHashtag(hashtag,cbSuccess,cbFail){
		$.ajax({
		  url: baseApiUrl+'/hashtag/'+hashtag+'/',
		  type: 'GET',
		  data: '',
		  success: cbSuccess,
		  fail: cbFail
		});
	}

	function putColour(hashtag,colour,cbSuccess,cbFail){
		$.ajax({
		  url: baseApiUrl+'/hashtag/'+hashtag+'/',
		  type: 'POST', // TODO: should be PUT but PHP is obnoxious... file_get_contents("php://input") 
		  data: 'colour='+colour+'&lat='+lat+'&lon='+lon,
		  success: cbSuccess,
		  fail: cbFail
		});

	}

	function getLocation() {
	    if (navigator.geolocation) {
	        navigator.geolocation.getCurrentPosition(setPosition);
	    }
	}

	function setPosition(pos){
		lon = pos.coords.latitude;
		lat = pos.coords.longitude;
	}

	return {
		init: init,
		getHashtag: getHashtag,
		putColour: putColour
	};

})();

function debugMeSuccess(data){	
	debugMe('SUCCESS:',data);
}
function debugMeFail(data){	
	debugMe('FAIL:',data);
}
function debugMe(message,data){
	console.log(message);	
	console.log(data);

}


$(document).ready(function(){

	SynAPI.init();
	//SynAPI.getHashtag('test',debugMeSuccess,debugMeFail);
	SynAPI.putColour('test','fc0c0c',debugMeSuccess,debugMeFail);



});


</script>


</head>
<body>
Synesthesia
</body>
</html>